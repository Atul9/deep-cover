#!/usr/bin/env ruby

require "bundler/setup"

require "deep_cover"
require_relative "../spec/tools"

def show_builtin(fn)
  puts format(fn, builtin_coverage(fn))
end

def show_our_cov(fn)
  puts format(fn, our_coverage(fn))
end

example = ARGV[0] || 'simple_if'
fn = "./spec/samples/#{example}.rb"
fn = "./spec/branch_cover/#{example}.rb" unless File.exist?(fn)
puts "Builtin:\n"
show_builtin(fn)
puts "\nPure Ruby:\n"
cover = show_our_cov(fn)
puts "\nGenerated code:\n"
context = DeepCover.context(fn)
puts context.covered_source
puts "\nParsed code:\n"
puts context.covered_ast
puts "\nBranch coverage:\n"

puts format_branch_cover(context)
