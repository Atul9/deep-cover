#!/usr/bin/env ruby

require "bundler/setup"

require "coverage"
require "deep_cover"

def show_builtin(fn)
	convert = Hash.new(' ')
	convert[0] = 'x'
	convert[nil] = '-'
	fn = File.expand_path(fn)
	Coverage.start
	require fn
	results = Coverage.result.fetch(fn)
	lines = File.readlines(fn)
	results.zip(lines).each do |cover, line|
		puts "#{convert[cover]} #{line}"
	end
end

def show_bc(fn)
	code = DeepCover.rewrite(fn)
	puts code
end

example = ARGV[0] || 'simple_if'
fn = "./spec/samples/#{example}.rb"
show_builtin(fn)
show_bc(fn)
